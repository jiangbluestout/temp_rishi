/******/ (function() { // webpackBootstrap
var __webpack_exports__ = {};
/*!***************************************************!*\
  !*** ./src/scripts/components/filter-and-sort.js ***!
  \***************************************************/
document.addEventListener("alpine:init", () => {
  Alpine.data("filterAndSort", () => ({
    labels: [],
    activeFilters: {},
    filterCount: 0,
    filtersOpen: false,
    sortOpen: false,
    sortBy: null,
    sortByLabel: null,
    collectionHandle: null,
    pageType: null,
    searchParams: null,
    loading: false,
    initializeForms() {
      const mobileForm = this.$refs.filter_form_mobile;
      const desktopForm = this.$refs.filter_form_desktop;
    },
    // toggle and focus the filter panel
    toggleFilterPanel() {
      this.filtersOpen = !this.filtersOpen;
      this.filtersOpen ? this.$nextTick(() => this.$refs.filtersPanel.focus()) : this.$nextTick(() => this.$refs.filtersButton.focus());
    },
    // toggle and focus the sort menu
    toggleSortMenu() {
      this.sortOpen = !this.sortOpen;
      this.sortOpen ? this.$nextTick(() => this.$refs.sortMenu.focus()) : this.$nextTick(() => this.$refs.sortButton.focus());
    },
    countTotalFilters(data) {
      let totalFilters = 0;
      Object.values(this.activeFilters).forEach(arr => {
        totalFilters += arr.length;
      });
      return totalFilters;
    },
    handleFilterValueClick(filterLabel, filter, category = null) {
      if (category == null) {
        category = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
      }
      const categoryString = "category-" + category;
      if (category) {
        // unselect all inputs in the category
        const categoryInputs = document.querySelectorAll(`#${categoryString}`);
        categoryInputs.forEach(input => {
          if (input.children[0].value !== filter && input.children[0].checked) {
            input.children[0].click();
          }
        });
      }
      if (this.activeFilters[filterLabel]) {
        if (this.activeFilters[filterLabel].includes(filter)) {
          this.activeFilters[filterLabel] = this.activeFilters[filterLabel].filter(item => item !== filter);
          if (this.activeFilters[filterLabel].length === 0) {
            delete this.activeFilters[filterLabel];
          }
        } else {
          this.activeFilters[filterLabel].push(filter);
        }
      } else {
        this.activeFilters[filterLabel] = [filter];
      }
      this.filterCount = this.countTotalFilters(this.activeFilters);
    },
    // clear all filters
    handleClearFilters() {
      this.activeFilters = {};
      this.$refs.filter_form.reset();
      this.$dispatch("filter-updated");
      this.filterCount = 0;
    },
    sortCollection(sortValue, sortByLabel) {
      this.sortBy = sortValue;
      this.sortByLabel = sortByLabel;
      this.sortOpen = false;
    },
    // update the url with the new filter values
    updateForm: {
      ["@filter-updated.window"]() {
        const formRef = this.$refs.filter_form;
        this.$nextTick(() => {
          // set the Form Data to a variable and remove empty values
          const formData = new FormData(formRef);
          for (let [name, value] of Array.from(formData.entries())) {
            if (value === "") formData.delete(name);
          }
          const queryString = new URLSearchParams(formData).toString();
          this.loading = true;
          let updatedQueryString;
          // update the url with the new filter values based on page type
          if (this.pageType === "collections") {
            updatedQueryString = `/${this.pageType}/${this.collectionHandle}?${queryString}`;
          }
          if (this.pageType === "search") {
            updatedQueryString = `/${this.pageType}?${this.searchParams}&${queryString}`;
          }
          // Example: Log the forms to the console
          console.log("Updated URL:", updatedQueryString);
          fetch(updatedQueryString).then(response => response.text())
          // update the dom with the new products
          .then(data => {
            let html_div = document.createElement("div");
            if (html_div) {
              html_div.innerHTML = data;
            }
            // html_div.textContent = String(data);
            // console.clear();
            // console.log("Type of data:", typeof data);
            // console.log("data:", html_div);
            let html_dom = html_div.querySelector("#productGridContainer").innerHTML;
            document.querySelector("#productGridContainer").innerHTML = html_dom;
            // update url without refreshing the page
            if (this.pageType === "collections") {
              history.replaceState(null, null, "?" + queryString);
            }
            if (this.pageType === "search") {
              history.replaceState(null, null, `?${this.searchParams}&${queryString}`);
            }

            setCollectionImageHeight();
          }).catch(error => console.error("Error:", error)).finally(() => this.loading = false);
        });
      }
    },
    // initialize the data based on the page type
    initializeData(sortBy, pageType, collectionHandle) {
      this.sortBy = sortBy;
      this.collectionHandle = collectionHandle;
      this.pageType = pageType;
      if (pageType === "search") {
        const urlParams = new URLSearchParams(location.search);
        for (const [key, value] of urlParams) {
          if (key === "q" && value) {
            this.searchParams = `q=${value.replace(/\s+/g, "+")}`;
          }
        }
      }
    },
    setSortByLabel(value, name) {
      if (value === this.sortBy) {
        this.sortByLabel = name;
      }
    },
    // capture tag labels
    captureLabels(tags) {
      function getUniqueLabels(tagsArray) {
        const labelMap = {};
        tagsArray.forEach(tag => {
          const parts = tag.split(":");
          if (parts.length === 2) {
            const label = parts[0];
            if (!labelMap[label]) {
              labelMap[label] = true;
            }
          }
        });
        return Object.keys(labelMap);
      }
      this.labels = getUniqueLabels(tags);
    }
  }));
});
/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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bXBvbmVudHMvZmlsdGVyLWFuZC1zb3J0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJhbHBpbmU6aW5pdFwiLCAoKSA9PiB7XG4gIEFscGluZS5kYXRhKFwiZmlsdGVyQW5kU29ydFwiLCAoKSA9PiAoe1xuICAgIGxhYmVsczogW10sXG4gICAgYWN0aXZlRmlsdGVyczoge30sXG4gICAgZmlsdGVyQ291bnQ6IDAsXG4gICAgZmlsdGVyc09wZW46IGZhbHNlLFxuICAgIHNvcnRPcGVuOiBmYWxzZSxcbiAgICBzb3J0Qnk6IG51bGwsXG4gICAgc29ydEJ5TGFiZWw6IG51bGwsXG4gICAgY29sbGVjdGlvbkhhbmRsZTogbnVsbCxcbiAgICBwYWdlVHlwZTogbnVsbCxcbiAgICBzZWFyY2hQYXJhbXM6IG51bGwsXG4gICAgbG9hZGluZzogZmFsc2UsXG5cbiAgICAvLyB0b2dnbGUgYW5kIGZvY3VzIHRoZSBmaWx0ZXIgcGFuZWxcbiAgICB0b2dnbGVGaWx0ZXJQYW5lbCgpIHtcbiAgICAgIHRoaXMuZmlsdGVyc09wZW4gPSAhdGhpcy5maWx0ZXJzT3BlbjtcbiAgICAgIHRoaXMuZmlsdGVyc09wZW5cbiAgICAgICAgPyB0aGlzLiRuZXh0VGljaygoKSA9PiB0aGlzLiRyZWZzLmZpbHRlcnNQYW5lbC5mb2N1cygpKVxuICAgICAgICA6IHRoaXMuJG5leHRUaWNrKCgpID0+IHRoaXMuJHJlZnMuZmlsdGVyc0J1dHRvbi5mb2N1cygpKTtcbiAgICB9LFxuXG4gICAgLy8gdG9nZ2xlIGFuZCBmb2N1cyB0aGUgc29ydCBtZW51XG4gICAgdG9nZ2xlU29ydE1lbnUoKSB7XG4gICAgICB0aGlzLnNvcnRPcGVuID0gIXRoaXMuc29ydE9wZW47XG4gICAgICB0aGlzLnNvcnRPcGVuXG4gICAgICAgID8gdGhpcy4kbmV4dFRpY2soKCkgPT4gdGhpcy4kcmVmcy5zb3J0TWVudS5mb2N1cygpKVxuICAgICAgICA6IHRoaXMuJG5leHRUaWNrKCgpID0+IHRoaXMuJHJlZnMuc29ydEJ1dHRvbi5mb2N1cygpKTtcbiAgICB9LFxuXG4gICAgY291bnRUb3RhbEZpbHRlcnMoZGF0YSkge1xuICAgICAgbGV0IHRvdGFsRmlsdGVycyA9IDA7XG5cbiAgICAgIE9iamVjdC52YWx1ZXModGhpcy5hY3RpdmVGaWx0ZXJzKS5mb3JFYWNoKChhcnIpID0+IHtcbiAgICAgICAgdG90YWxGaWx0ZXJzICs9IGFyci5sZW5ndGg7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHRvdGFsRmlsdGVycztcbiAgICB9LFxuXG4gICAgLy8gYWRkL3JlbW92ZSBmaWx0ZXJzIGZyb20gdGhlIGFjdGl2ZUZpbHRlcnMgb2JqZWN0XG4gICAgaGFuZGxlRmlsdGVyVmFsdWVDbGljayhmaWx0ZXJMYWJlbCwgZmlsdGVyLCBjYXRlZ29yeSA9IG51bGwpIHtcbiAgICAgIGNvbnN0IGNhdGVnb3J5U3RyaW5nID0gXCJjYXRlZ29yeS1cIiArIGNhdGVnb3J5O1xuICAgICAgaWYgKGNhdGVnb3J5KSB7XG4gICAgICAgIC8vIHVuc2VsZWN0IGFsbCBpbnB1dHMgaW4gdGhlIGNhdGVnb3J5XG4gICAgICAgIGNvbnN0IGNhdGVnb3J5SW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgIyR7Y2F0ZWdvcnlTdHJpbmd9YCk7XG4gICAgICAgIGNhdGVnb3J5SW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICAgICAgaWYgKGlucHV0LmNoaWxkcmVuWzBdLnZhbHVlICE9PSBmaWx0ZXIgJiYgaW5wdXQuY2hpbGRyZW5bMF0uY2hlY2tlZCkge1xuICAgICAgICAgICAgaW5wdXQuY2hpbGRyZW5bMF0uY2xpY2soKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuYWN0aXZlRmlsdGVyc1tmaWx0ZXJMYWJlbF0pIHtcbiAgICAgICAgaWYgKHRoaXMuYWN0aXZlRmlsdGVyc1tmaWx0ZXJMYWJlbF0uaW5jbHVkZXMoZmlsdGVyKSkge1xuICAgICAgICAgIHRoaXMuYWN0aXZlRmlsdGVyc1tmaWx0ZXJMYWJlbF0gPSB0aGlzLmFjdGl2ZUZpbHRlcnNbXG4gICAgICAgICAgICBmaWx0ZXJMYWJlbFxuICAgICAgICAgIF0uZmlsdGVyKChpdGVtKSA9PiBpdGVtICE9PSBmaWx0ZXIpO1xuICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUZpbHRlcnNbZmlsdGVyTGFiZWxdLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMuYWN0aXZlRmlsdGVyc1tmaWx0ZXJMYWJlbF07XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuYWN0aXZlRmlsdGVyc1tmaWx0ZXJMYWJlbF0ucHVzaChmaWx0ZXIpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmFjdGl2ZUZpbHRlcnNbZmlsdGVyTGFiZWxdID0gW2ZpbHRlcl07XG4gICAgICB9XG4gICAgICB0aGlzLmZpbHRlckNvdW50ID0gdGhpcy5jb3VudFRvdGFsRmlsdGVycyh0aGlzLmFjdGl2ZUZpbHRlcnMpO1xuICAgIH0sXG5cbiAgICAvLyBjbGVhciBhbGwgZmlsdGVyc1xuICAgIGhhbmRsZUNsZWFyRmlsdGVycygpIHtcbiAgICAgIHRoaXMuYWN0aXZlRmlsdGVycyA9IHt9O1xuICAgICAgdGhpcy4kcmVmcy5maWx0ZXJfZm9ybS5yZXNldCgpO1xuICAgICAgdGhpcy4kZGlzcGF0Y2goXCJmaWx0ZXItdXBkYXRlZFwiKTtcbiAgICAgIHRoaXMuZmlsdGVyQ291bnQgPSAwO1xuICAgIH0sXG5cbiAgICBzb3J0Q29sbGVjdGlvbihzb3J0VmFsdWUsIHNvcnRCeUxhYmVsKSB7XG4gICAgICB0aGlzLnNvcnRCeSA9IHNvcnRWYWx1ZTtcbiAgICAgIHRoaXMuc29ydEJ5TGFiZWwgPSBzb3J0QnlMYWJlbDtcbiAgICAgIHRoaXMuc29ydE9wZW4gPSBmYWxzZTtcbiAgICB9LFxuXG4gICAgLy8gdXBkYXRlIHRoZSB1cmwgd2l0aCB0aGUgbmV3IGZpbHRlciB2YWx1ZXNcbiAgICB1cGRhdGVGb3JtOiB7XG4gICAgICBbXCJAZmlsdGVyLXVwZGF0ZWQud2luZG93XCJdKCkge1xuICAgICAgICBjb25zdCBmb3JtUmVmID0gdGhpcy4kcmVmcy5maWx0ZXJfZm9ybTtcbiAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4ge1xuICAgICAgICAgIC8vIHNldCB0aGUgRm9ybSBEYXRhIHRvIGEgdmFyaWFibGUgYW5kIHJlbW92ZSBlbXB0eSB2YWx1ZXNcbiAgICAgICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YShmb3JtUmVmKTtcbiAgICAgICAgICBmb3IgKGxldCBbbmFtZSwgdmFsdWVdIG9mIEFycmF5LmZyb20oZm9ybURhdGEuZW50cmllcygpKSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlID09PSBcIlwiKSBmb3JtRGF0YS5kZWxldGUobmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IHF1ZXJ5U3RyaW5nID0gbmV3IFVSTFNlYXJjaFBhcmFtcyhmb3JtRGF0YSkudG9TdHJpbmcoKTtcbiAgICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgIGxldCB1cGRhdGVkUXVlcnlTdHJpbmc7XG4gICAgICAgICAgLy8gdXBkYXRlIHRoZSB1cmwgd2l0aCB0aGUgbmV3IGZpbHRlciB2YWx1ZXMgYmFzZWQgb24gcGFnZSB0eXBlXG4gICAgICAgICAgaWYgKHRoaXMucGFnZVR5cGUgPT09IFwiY29sbGVjdGlvbnNcIikge1xuICAgICAgICAgICAgdXBkYXRlZFF1ZXJ5U3RyaW5nID0gYC8ke3RoaXMucGFnZVR5cGV9LyR7dGhpcy5jb2xsZWN0aW9uSGFuZGxlfT8ke3F1ZXJ5U3RyaW5nfWA7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICh0aGlzLnBhZ2VUeXBlID09PSBcInNlYXJjaFwiKSB7XG4gICAgICAgICAgICB1cGRhdGVkUXVlcnlTdHJpbmcgPSBgLyR7dGhpcy5wYWdlVHlwZX0/JHt0aGlzLnNlYXJjaFBhcmFtc30mJHtxdWVyeVN0cmluZ31gO1xuICAgICAgICAgIH1cbiAgICAgICAgICBmZXRjaCh1cGRhdGVkUXVlcnlTdHJpbmcpXG4gICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHJlc3BvbnNlLnRleHQoKSlcbiAgICAgICAgICAgIC8vIHVwZGF0ZSB0aGUgZG9tIHdpdGggdGhlIG5ldyBwcm9kdWN0c1xuICAgICAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgbGV0IGh0bWxfZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgICAgICAgaHRtbF9kaXYuaW5uZXJIVE1MID0gZGF0YTtcbiAgICAgICAgICAgICAgbGV0IGh0bWxfZG9tID0gaHRtbF9kaXYucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgICAgICBcIiNwcm9kdWN0R3JpZENvbnRhaW5lclwiXG4gICAgICAgICAgICAgICkuaW5uZXJIVE1MO1xuICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2R1Y3RHcmlkQ29udGFpbmVyXCIpLmlubmVySFRNTCA9XG4gICAgICAgICAgICAgICAgaHRtbF9kb207XG4gICAgICAgICAgICAgIC8vIHVwZGF0ZSB1cmwgd2l0aG91dCByZWZyZXNoaW5nIHRoZSBwYWdlXG4gICAgICAgICAgICAgIGlmICh0aGlzLnBhZ2VUeXBlID09PSBcImNvbGxlY3Rpb25zXCIpIHtcbiAgICAgICAgICAgICAgICBoaXN0b3J5LnJlcGxhY2VTdGF0ZShudWxsLCBudWxsLCBcIj9cIiArIHF1ZXJ5U3RyaW5nKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAodGhpcy5wYWdlVHlwZSA9PT0gXCJzZWFyY2hcIikge1xuICAgICAgICAgICAgICAgIGhpc3RvcnkucmVwbGFjZVN0YXRlKFxuICAgICAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgICAgICBgPyR7dGhpcy5zZWFyY2hQYXJhbXN9JiR7cXVlcnlTdHJpbmd9YFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiBjb25zb2xlLmVycm9yKFwiRXJyb3I6XCIsIGVycm9yKSlcbiAgICAgICAgICAgIC5maW5hbGx5KCgpID0+ICh0aGlzLmxvYWRpbmcgPSBmYWxzZSkpO1xuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgfSxcblxuICAgIC8vIGluaXRpYWxpemUgdGhlIGRhdGEgYmFzZWQgb24gdGhlIHBhZ2UgdHlwZVxuICAgIGluaXRpYWxpemVEYXRhKHNvcnRCeSwgcGFnZVR5cGUsIGNvbGxlY3Rpb25IYW5kbGUpIHtcbiAgICAgIHRoaXMuc29ydEJ5ID0gc29ydEJ5O1xuICAgICAgdGhpcy5jb2xsZWN0aW9uSGFuZGxlID0gY29sbGVjdGlvbkhhbmRsZTtcbiAgICAgIHRoaXMucGFnZVR5cGUgPSBwYWdlVHlwZTtcbiAgICAgIGlmIChwYWdlVHlwZSA9PT0gXCJzZWFyY2hcIikge1xuICAgICAgICBjb25zdCB1cmxQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKGxvY2F0aW9uLnNlYXJjaCk7XG4gICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIHVybFBhcmFtcykge1xuICAgICAgICAgIGlmIChrZXkgPT09IFwicVwiICYmIHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLnNlYXJjaFBhcmFtcyA9IGBxPSR7dmFsdWUucmVwbGFjZSgvXFxzKy9nLCBcIitcIil9YDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIHNldFNvcnRCeUxhYmVsKHZhbHVlLCBuYW1lKSB7XG4gICAgICBpZiAodmFsdWUgPT09IHRoaXMuc29ydEJ5KSB7XG4gICAgICAgIHRoaXMuc29ydEJ5TGFiZWwgPSBuYW1lO1xuICAgICAgfVxuICAgIH0sXG4gICAgLy8gY2FwdHVyZSB0YWcgbGFiZWxzXG4gICAgY2FwdHVyZUxhYmVscyh0YWdzKSB7XG4gICAgICBmdW5jdGlvbiBnZXRVbmlxdWVMYWJlbHModGFnc0FycmF5KSB7XG4gICAgICAgIGNvbnN0IGxhYmVsTWFwID0ge307XG4gICAgICAgIHRhZ3NBcnJheS5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICAgICAgICBjb25zdCBwYXJ0cyA9IHRhZy5zcGxpdChcIjpcIik7XG4gICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikge1xuICAgICAgICAgICAgY29uc3QgbGFiZWwgPSBwYXJ0c1swXTtcbiAgICAgICAgICAgIGlmICghbGFiZWxNYXBbbGFiZWxdKSB7XG4gICAgICAgICAgICAgIGxhYmVsTWFwW2xhYmVsXSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKGxhYmVsTWFwKTtcbiAgICAgIH1cbiAgICAgIHRoaXMubGFiZWxzID0gZ2V0VW5pcXVlTGFiZWxzKHRhZ3MpO1xuICAgIH0sXG4gIH0pKTtcbn0pO1xuIl0sIm5hbWVzIjpbImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsIkFscGluZSIsImRhdGEiLCJsYWJlbHMiLCJhY3RpdmVGaWx0ZXJzIiwiZmlsdGVyQ291bnQiLCJmaWx0ZXJzT3BlbiIsInNvcnRPcGVuIiwic29ydEJ5Iiwic29ydEJ5TGFiZWwiLCJjb2xsZWN0aW9uSGFuZGxlIiwicGFnZVR5cGUiLCJzZWFyY2hQYXJhbXMiLCJsb2FkaW5nIiwidG9nZ2xlRmlsdGVyUGFuZWwiLCIkbmV4dFRpY2siLCIkcmVmcyIsImZpbHRlcnNQYW5lbCIsImZvY3VzIiwiZmlsdGVyc0J1dHRvbiIsInRvZ2dsZVNvcnRNZW51Iiwic29ydE1lbnUiLCJzb3J0QnV0dG9uIiwiY291bnRUb3RhbEZpbHRlcnMiLCJ0b3RhbEZpbHRlcnMiLCJPYmplY3QiLCJ2YWx1ZXMiLCJmb3JFYWNoIiwiYXJyIiwibGVuZ3RoIiwiaGFuZGxlRmlsdGVyVmFsdWVDbGljayIsImZpbHRlckxhYmVsIiwiZmlsdGVyIiwiY2F0ZWdvcnkiLCJhcmd1bWVudHMiLCJ1bmRlZmluZWQiLCJjYXRlZ29yeVN0cmluZyIsImNhdGVnb3J5SW5wdXRzIiwicXVlcnlTZWxlY3RvckFsbCIsImlucHV0IiwiY2hpbGRyZW4iLCJ2YWx1ZSIsImNoZWNrZWQiLCJjbGljayIsImluY2x1ZGVzIiwiaXRlbSIsInB1c2giLCJoYW5kbGVDbGVhckZpbHRlcnMiLCJmaWx0ZXJfZm9ybSIsInJlc2V0IiwiJGRpc3BhdGNoIiwic29ydENvbGxlY3Rpb24iLCJzb3J0VmFsdWUiLCJ1cGRhdGVGb3JtIiwiQGZpbHRlci11cGRhdGVkLndpbmRvdyIsImZvcm1SZWYiLCJmb3JtRGF0YSIsIkZvcm1EYXRhIiwibmFtZSIsIkFycmF5IiwiZnJvbSIsImVudHJpZXMiLCJkZWxldGUiLCJxdWVyeVN0cmluZyIsIlVSTFNlYXJjaFBhcmFtcyIsInRvU3RyaW5nIiwidXBkYXRlZFF1ZXJ5U3RyaW5nIiwiZmV0Y2giLCJ0aGVuIiwicmVzcG9uc2UiLCJ0ZXh0IiwiaHRtbF9kaXYiLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwiaHRtbF9kb20iLCJxdWVyeVNlbGVjdG9yIiwiaGlzdG9yeSIsInJlcGxhY2VTdGF0ZSIsImNhdGNoIiwiZXJyb3IiLCJjb25zb2xlIiwiZmluYWxseSIsImluaXRpYWxpemVEYXRhIiwidXJsUGFyYW1zIiwibG9jYXRpb24iLCJzZWFyY2giLCJrZXkiLCJyZXBsYWNlIiwic2V0U29ydEJ5TGFiZWwiLCJjYXB0dXJlTGFiZWxzIiwidGFncyIsImdldFVuaXF1ZUxhYmVscyIsInRhZ3NBcnJheSIsImxhYmVsTWFwIiwidGFnIiwicGFydHMiLCJzcGxpdCIsImxhYmVsIiwia2V5cyJdLCJzb3VyY2VSb290IjoiIn0=